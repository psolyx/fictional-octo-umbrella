# Risk register

This register tracks material delivery, security, and operational risks. Each entry includes a concrete proof test to validate the mitigation.

| Risk ID | Description | Impact | Likelihood | Detection | Mitigation | Proof test | Status |
| --- | --- | --- | --- | --- | --- | --- | --- |
| RR-001 | CDN websocket drops break resume semantics or lose messages. | High | Medium | Gateway metrics for reconnects/replays; client gap detection alerts. | Deterministic resume tokens; per-conversation `seq` replay; idempotent `msg_id`; backpressure on replay. | Chaos test: force midstream disconnects across 10k cycles; verify monotonic `seq`, no gaps/dupes on reconnect/resume. | Open |
| RR-002 | Presence privacy leaks via surveillance or over-broad visibility (contacts-only, invisible mode, coarse last-seen). | High | Medium | Audit presence API responses and access checks; rate-limit telemetry for watchlists. | Contacts-only subscriptions; watchlist caps; per-watcher and per-target rate limits; coarse bucketed last-seen; invisible mode enforcement. | Red-team scrape simulation: bots attempt large watchlists; assert throttling/blocks and absence of fine-grained timestamps. | Open |
| RR-003 | Delivery Service ordering/idempotency bugs (`seq` per `conv_id`; (`conv_id`, `msg_id`) uniqueness). | High | Medium | Duplicate/gap detectors in DS logs; client ack validation; invariant checks in tests. | Strongly-consistent server `seq` assignment; dedupe on (`conv_id`, `msg_id`); idempotent storage; replay on resume. | Harness: inject duplicate and out-of-order sends; assert single storage per (`conv_id`, `msg_id`) and ordered broadcast by `seq`. | Open |
| RR-004 | Echo-before-apply violations cause MLS state divergence. | High | Medium | Client self-check: hold local commits until echoed; DS audit for premature apply; MLS conformance suite. | Enforce DS echo discipline in client/gateway code paths; test vectors covering commit races; ordered delivery. | Simulation: multi-member churn with injected commit races; assert no forks and that clients only apply commits after echo. | Open |
| RR-005 | KeyPackage directory enumeration, spam, or abuse. | Medium | Medium | Rate-limit metrics; auth logs on fetch/upload; anomaly detection for pool depletion. | Authenticated fetch by default; rate limits on uploads/fetches; one-time-use issuance with pool replenishment; optional last-resort packages gated. | Load test: adversarial fetch storm; assert rate limits trigger, pools replenish, and no unauthenticated enumeration. | Open |
| RR-006 | Store-and-forward retention leaks or legal/ops exposure. | High | Medium | Audit retention configs; storage utilization dashboards; access control logs. | Configurable retention windows; encryption-at-rest; strict access controls; operator runbooks for purge/legal holds. | Retention drill: configure short retention, send messages, verify expired ciphertext removed and audit trail captured. | Open |
| RR-007 | Self-hosted deployments behind arbitrary CDN/proxy break protocol semantics. | Medium | Medium | Deployment checklists; integration tests against common CDN behaviors; operator feedback loop. | Limit protocol to standard HTTP(S)/WS/SSE; document CDN requirements; heartbeat + resume semantics tolerant to midstream closes. | Interop test: deploy behind representative CDNs/proxies; run upgrade/reconnect/resume suite without protocol deviations. | Open |
| RR-008 | DoS via subscription or presence churn. | High | Medium | Rate-limit counters; resource usage monitors; alerting on subscription churn spikes. | Per-device and per-watcher rate limits; watchlist caps; backpressure/disconnect penalties; bounded presence lease TTLs. | Load test: churn subscriptions/presence updates at abusive rates; assert rate limits, disconnect penalties, and stable resource usage. | Open |
| RR-009 | MLS library immaturity or persistence bugs cause state loss or decrypt failures. | High | Medium | Harness telemetry for persistence reloads; application-level alerts on decrypt failures; soak tests. | Deterministic harness with vendored Go MLS library; message vectors plus persistence round-trips; interop testing later. | Proof test: 2-party DM simulation with periodic save/load and 1k message exchange without forks or decrypt failures. | Open |
