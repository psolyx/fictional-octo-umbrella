# Risk register

This register tracks material delivery, security, and operational risks. Each entry includes a concrete proof test to validate the mitigation.

| Risk ID | Description | Impact | Likelihood | Detection | Mitigation | Proof test | Status |
| --- | --- | --- | --- | --- | --- | --- | --- |
| RR-001 | CDN websocket drops break resume semantics or lose messages. | High | Medium | Gateway metrics for reconnects/replays; client gap detection alerts. | Deterministic resume tokens; per-conversation `seq` replay; idempotent `msg_id`; backpressure on replay. | Chaos test: force midstream disconnects across 10k cycles; verify monotonic `seq`, no gaps/dupes on reconnect/resume. | Open |
| RR-002 | Presence privacy leaks via surveillance or over-broad visibility (contacts-only, invisible mode, coarse last-seen). | High | Medium | Audit presence API responses and access checks; rate-limit telemetry for watchlists. | Contacts-only subscriptions; watchlist caps; per-watcher and per-target rate limits; coarse bucketed last-seen; invisible mode enforcement. | Red-team scrape simulation: bots attempt large watchlists; assert throttling/blocks and absence of fine-grained timestamps. | Open |
| RR-003 | Delivery Service ordering/idempotency bugs (`seq` per `conv_id`; (`conv_id`, `msg_id`) uniqueness). | High | Medium | Duplicate/gap detectors in DS logs; client ack validation; invariant checks in tests. | Strongly-consistent server `seq` assignment; dedupe on (`conv_id`, `msg_id`); idempotent storage; replay on resume. | Harness: inject duplicate and out-of-order sends; assert single storage per (`conv_id`, `msg_id`) and ordered broadcast by `seq`. | Open |
| RR-004 | Echo-before-apply violations cause MLS state divergence. | High | Medium | Client self-check: hold local commits until echoed; DS audit for premature apply; MLS conformance suite. | Enforce DS echo discipline in client/gateway code paths; test vectors covering commit races; ordered delivery. | Simulation: multi-member churn with injected commit races; assert no forks and that clients only apply commits after echo. | Open |
| RR-005 | KeyPackage directory enumeration, spam, or abuse. | Medium | Medium | Rate-limit metrics; auth logs on fetch/upload; anomaly detection for pool depletion. | Authenticated fetch by default; rate limits on uploads/fetches; one-time-use issuance with pool replenishment; optional last-resort packages gated. | Load test: adversarial fetch storm; assert rate limits trigger, pools replenish, and no unauthenticated enumeration. | Open |
| RR-006 | Store-and-forward retention leaks or legal/ops exposure. | High | Medium | Audit retention configs; storage utilization dashboards; access control logs. | Configurable retention windows; encryption-at-rest; strict access controls; operator runbooks for purge/legal holds. | Retention drill: configure short retention, send messages, verify expired ciphertext removed and audit trail captured. | Open |
| RR-007 | Self-hosted deployments behind arbitrary CDN/proxy break protocol semantics. | Medium | Medium | Deployment checklists; integration tests against common CDN behaviors; operator feedback loop. | Limit protocol to standard HTTP(S)/WS/SSE; document CDN requirements; heartbeat + resume semantics tolerant to midstream closes. | Interop test: deploy behind representative CDNs/proxies; run upgrade/reconnect/resume suite without protocol deviations. | Open |
| RR-008 | DoS via subscription or presence churn. | High | Medium | Rate-limit counters; resource usage monitors; alerting on subscription churn spikes. | Per-device and per-watcher rate limits; watchlist caps; backpressure/disconnect penalties; bounded presence lease TTLs. | Load test: churn subscriptions/presence updates at abusive rates; assert rate limits, disconnect penalties, and stable resource usage. | Open |
| RR-009 | MLS library immaturity or persistence bugs cause state loss or decrypt failures. | High | Medium | Harness telemetry for persistence reloads; application-level alerts on decrypt failures; soak tests. | Deterministic harness with vendored Go MLS library; message vectors plus persistence round-trips; interop testing later. | Proof test: 2-party DM simulation with periodic save/load and 1k message exchange without forks or decrypt failures. | Open |
| RR-010 | Browser WASM MLS build diverges from Go harness or bloats bundles. | Medium | Medium | Build pipeline and bundle size checks; browser vector smoke tests. | Go-to-WASM build of existing harness, JS shim mirroring CLI, offline vendored deps only. | Proof test: run MLSWG vectors in browser/WASM build and compare outputs to CLI; measure bundle size against budget. | Open |
| RR-011 | Protocol ossification makes gateway federation require breaking wire changes or dual-stack support. | Medium | Medium | Spec reviews for routing metadata; integration tests covering reserved fields. | Phase 1.5 routing metadata reservations (`conv_home`, `origin_gateway`, KeyPackage `served_by`/`user_home_gateway`); ADR 0006 “relay-to-home” posture to guide v2. | Proof test: exercise v1 clients against routing metadata fields; verify compatibility and presence of reserved fields in emitted events/acks. | Open |
| RR-012 | Web frontend dependency/supply-chain compromise or vulnerability bloat. | Medium | Medium | Static artifact audits; CSP validation; periodic review of committed web assets. | Frameworkless/static posture; no npm in critical path; committed artifacts only; strict CSP; documented offline dev workflow. | Proof test: verify `clients/web` has no package manager files or build instructions requiring Node; confirm CSP guidance present and deployment path uses committed static assets. | Open |
| RR-013 | `gateway_id` collisions or undefined discovery mapping make future federation rollout breaking. | Medium | Medium | Spec reviews for routing metadata and discovery hints; deployment configuration checks. | Documented global uniqueness + stability for `gateway_id`, immutable `conv_home`, client non-assumption of `origin_gateway == conv_home`, and standardized directory-based discovery mapping to URLs. | Proof test: review specs/ADRs to confirm the directory discovery convention, deterministic `conv_home` selection rule, and non-equality examples are present; integration harness rejects clients that assume equality. | Open |
