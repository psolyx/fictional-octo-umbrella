<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gateway WebSocket demo</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>Gateway v1 WebSocket demo</h1>
  <p>This static page exercises gateway session lifecycle, conversation subscription with optional replay, ack, and ciphertext send flows.</p>

  <fieldset>
    <legend>Connection</legend>
    <label>
      Gateway WS URL
      <input type="text" id="gateway_url" size="64" placeholder="ws://localhost:8787/v1/ws" />
    </label>
    <label>
      auth_token (for session.start)
      <input type="text" id="bootstrap_token" size="48" />
    </label>
    <label>
      device_id
      <input type="text" id="device_id" size="32" />
    </label>
    <label>
      device_credential
      <input type="text" id="device_credential" size="48" />
    </label>
    <label>
      Resume token (for session.resume)
      <input type="text" id="resume_token" size="48" />
    </label>
    <div class="button-row">
      <button id="connect_start">Start session</button>
      <button id="connect_resume">Resume session</button>
      <span id="connection_status">disconnected</span>
    </div>
  </fieldset>

  <fieldset>
    <legend>Conversation controls</legend>
    <label>
      Conversation ID
      <input type="text" id="conv_id" size="32" />
    </label>
    <label>
      from_seq (optional subscribe replay)
      <input type="number" id="from_seq" min="0" />
    </label>
    <label>
      seq
      <input type="number" id="seq" min="0" />
    </label>
    <label>
      msg_id
      <input type="text" id="msg_id" size="24" />
    </label>
    <label>
      Ciphertext payload
      <input type="text" id="ciphertext_input" size="64" />
    </label>
    <div class="button-row">
      <button id="subscribe_btn">Subscribe</button>
      <button id="ack_btn">Ack</button>
      <button id="send_btn">Send ciphertext</button>
    </div>
  </fieldset>

  <fieldset>
    <legend>Received events</legend>
    <div id="event_log"></div>
  </fieldset>

  <fieldset>
    <legend>Debug log</legend>
    <textarea id="debug_log" readonly></textarea>
    <button id="clear_log">Clear log</button>
  </fieldset>

  <fieldset>
    <legend>MLS vectors</legend>
    <p>Verify the deterministic DM vector with the Go harness compiled to WASM.</p>
    <div class="button-row">
      <button id="run_vectors">Run vectors</button>
      <span id="vector_status">idle</span>
    </div>
    <pre id="vector_output"></pre>
  </fieldset>

  <script src="vendor/wasm_exec.js"></script>
  <script type="module" src="vectors_ui.js"></script>
  <script src="gateway_ws_client.js"></script>
</body>
</html>
